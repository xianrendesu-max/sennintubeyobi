<!DOCTYPE html>
<html lang="ja">
<head>
    <title>仙人tube</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <link rel="stylesheet" href="/css/pure-min.css">
    <link rel="stylesheet" href="/css/grids-responsive-min.css">
    <link rel="stylesheet" href="/css/ionicons.min.css">
    <link rel="stylesheet" href="/css/default.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- 追加CSS -->
    <style>
        body {
            background: #f6f8fb;
            font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", sans-serif;
            color: #222;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* ナビバー */
        .navbar {
            background: white;
            padding: 16px;
            border-radius: 14px;
            box-shadow: 0 8px 20px rgba(0,0,0,.05);
            margin-bottom: 20px;
        }

        /* 検索バー */
        #searchbox {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            border-radius: 999px;
            border: 1px solid #ddd;
            transition: box-shadow .2s;
        }

        #searchbox:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59,130,246,.25);
        }

        /* チャンネル */
        .channel-profile {
            display: flex;
            align-items: center;
            gap: 14px;
            font-size: 22px;
            font-weight: bold;
        }

        .channel-profile img {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,.15);
        }

        /* 説明 */
        #descriptionWrapper {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,.05);
            margin-bottom: 30px;
            animation: fadeIn .6s ease;
        }

        /* カード */
        .h-box {
            background: white;
            padding: 14px;
            border-radius: 16px;
            box-shadow: 0 10px 24px rgba(0,0,0,.08);
            height: 100%;
            transition: transform .2s, box-shadow .2s;
            animation: fadeUp .4s ease;
        }

        .h-box:hover {
            transform: translateY(-6px);
            box-shadow: 0 16px 40px rgba(0,0,0,.12);
        }

        /* サムネ */
        .thumbnail img {
            width: 100%;
            border-radius: 12px;
        }

        .thumbnail {
            position: relative;
        }

        .length {
            position: absolute;
            bottom: 6px;
            right: 6px;
            background: rgba(0,0,0,.75);
            color: white;
            font-size: 12px;
            padding: 4px 6px;
            border-radius: 6px;
        }

        /* 動画情報 */
        .video-card-row {
            font-size: 13px;
            color: #666;
            margin-top: 4px;
        }

        /* Toastアラート */
        #toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #2563eb;
            color: white;
            padding: 14px 20px;
            border-radius: 999px;
            box-shadow: 0 10px 30px rgba(0,0,0,.25);
            opacity: 0;
            transform: translateY(20px);
            transition: all .3s ease;
            z-index: 999;
        }

        #toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* アニメーション */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>

<body class="no-theme">

<div id="toast">プロキシを有効化しました</div>

<div class="pure-g">
    <div class="pure-u-1 pure-u-md-2-24"></div>

    <div class="pure-u-1 pure-u-md-20-24" id="contents">

        <!-- ナビ -->
        <div class="pure-g navbar">
            <div class="pure-u-1">
                <form class="pure-form" action="/search" method="get">
                    <input type="search" id="searchbox" name="q" placeholder="検索">
                </form>
            </div>
        </div>

        <!-- チャンネル -->
        <div class="pure-g">
            <div class="pure-u-1">
                <div class="channel-profile">
                    <img src="{{channelicon}}">
                    <span>{{channelname}}</span>
                </div>
            </div>
        </div>

        <!-- 説明 -->
        <div id="descriptionWrapper">
            <span style="white-space:pre-wrap">{{channelprofile | safe}}</span>
        </div>

        <!-- 一覧 -->
        <div class="pure-g">
            {% for result in results %}
            <div class="pure-u-1 pure-u-md-1-4">
                <div class="h-box">
                    {% if result["type"] == "video" %}
                    <a href="/watch?v={{ result['id'] }}">
                        <div class="thumbnail">
                            <img loading="lazy"
                                 src="{% if proxy == "True" %}/thumbnail?v={{ result['id'] }}{% else %}https://img.youtube.com/vi/{{ result['id'] }}/0.jpg{% endif %}"
                                 onerror="enableProxy()">
                            <div class="length">{{result["length"]}}</div>
                        </div>
                        <p>{{ result['title'] }}</p>
                    </a>
                    <div class="video-card-row">
                        <a href="/channel/{{result['authorId']}}">{{result["author"]}}</a>
                    </div>
                    <div class="video-card-row">{{result["published"]}}</div>

                    {% elif result["type"] == "channel" %}
                    <a href="/channel/{{result["id"]}}">
                        <center>
                            <img style="width:60%;border-radius:50%" src="{{result["thumbnail"]}}">
                        </center>
                        <p>{{result["author"]}}</p>
                    </a>

                    {% elif result["type"] == "playlist" %}
                    <a href="/playlist?list={{result["id"]}}">
                        <div class="thumbnail">
                            <img src="https://img.youtube.com/vi/{{ result['thumbnail'] }}/0.jpg">
                            <div class="length">{{result["count"]}}本</div>
                        </div>
                        <p>{{result["title"]}}</p>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

    </div>
</div>

<script>
function enableProxy() {
    document.cookie = "proxy=True;max-age=2592000;";
    const toast = document.getElementById("toast");
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 3000);
}

$('#searchbox').autocomplete({
    source: function (request, response) {
        fetch("/suggest?keyword=" + request.term)
            .then(res => res.json())
            .then(data => response(data));
    },
    delay: 300
});
</script>

</body>
</html>
