<!DOCTYPE html>
<html lang="ja">
<head>
    <title>検索結果 - 仙人tube</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <link rel="stylesheet" href="/css/pure-min.css">
    <link rel="stylesheet" href="/css/grids-responsive-min.css">
    <link rel="stylesheet" href="/css/ionicons.min.css">
    <link rel="stylesheet" href="/css/default.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <style>
        body {
            background: #f6f7fb;
            font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", sans-serif;
            color: #111827;
            margin: 0;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* ===== ナビバー ===== */
        .navbar {
            background: white;
            padding: 16px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,.06);
            margin: 16px 0 28px;
            position: sticky;
            top: 12px;
            z-index: 10;
        }

        #searchbox {
            width: 100%;
            padding: 14px 20px;
            font-size: 16px;
            border-radius: 999px;
            border: 1px solid #d1d5db;
        }

        #searchbox:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(99,102,241,.3);
        }

        /* ===== グリッド（修正点ここ） ===== */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, max-content));
            justify-content: center;
            gap: 20px;
        }

        /* ===== カード ===== */
        .video-card {
            background: white;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,.08);
            transition: transform .25s, box-shadow .25s;
            animation: fadeUp .35s ease both;
        }

        .video-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 18px 50px rgba(0,0,0,.18);
        }

        /* サムネ */
        .thumbnail {
            position: relative;
            aspect-ratio: 16 / 9;
            overflow: hidden;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform .3s;
        }

        .video-card:hover img {
            transform: scale(1.06);
        }

        .length {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0,0,0,.75);
            color: white;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 8px;
        }

        /* テキスト */
        .card-body {
            padding: 12px 14px 14px;
        }

        .card-title {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .meta {
            font-size: 12px;
            color: #6b7280;
        }

        .meta a {
            color: #2563eb;
            font-weight: 500;
        }

        /* チャンネル */
        .channel-card img {
            width: 80px;
            border-radius: 50%;
            margin: 16px auto 10px;
            display: block;
        }

        /* ページ送り */
        .pager {
            margin: 40px 0;
            text-align: center;
        }

        .pager a {
            background: linear-gradient(135deg, #6366f1, #22d3ee);
            color: white;
            padding: 14px 26px;
            border-radius: 999px;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,.25);
        }

        /* アニメーション */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== 画面別最適化 ===== */
        @media (max-width: 768px) {
            .navbar {
                margin-top: 8px;
            }
        }
    </style>
</head>

<body class="no-theme">

<div class="pure-g">
    <div class="pure-u-1 pure-u-md-1-24"></div>

    <div class="pure-u-1 pure-u-md-22-24">

        <!-- 検索 -->
        <div class="navbar">
            <form class="pure-form" action="/search" method="get">
                <input type="search" id="searchbox" name="q" value="{{ word }}" placeholder="検索">
            </form>
        </div>

        <!-- 結果 -->
        <div class="results-grid">
            {% for result in results %}

            {% if result["type"] == "video" %}
            <a href="/watch?v={{ result['id'] }}">
                <div class="video-card">
                    <div class="thumbnail">
                        <img loading="lazy"
                             src="{% if proxy == "True" %}/thumbnail?v={{ result['id'] }}{% else %}https://img.youtube.com/vi/{{ result['id'] }}/0.jpg{% endif %}"
                             onerror="document.cookie='proxy=True;max-age=2592000;'">
                        <div class="length">{{ result["length"] }}</div>
                    </div>
                    <div class="card-body">
                        <div class="card-title">{{ result["title"] }}</div>
                        <div class="meta">
                            <a href="/channel/{{result['authorId']}}">{{result["author"]}}</a><br>
                            {{result["published"]}}
                        </div>
                    </div>
                </div>
            </a>

            {% elif result["type"] == "channel" %}
            <a href="/channel/{{result["id"]}}">
                <div class="video-card channel-card">
                    <img src="{{result["thumbnail"]}}">
                    <div class="card-body">
                        <div class="card-title" style="text-align:center">
                            {{result["author"]}}
                        </div>
                    </div>
                </div>
            </a>

            {% elif result["type"] == "playlist" %}
            <a href="/playlist?list={{result["id"]}}">
                <div class="video-card">
                    <div class="thumbnail">
                        <img src="https://img.youtube.com/vi/{{ result['thumbnail'] }}/0.jpg">
                        <div class="length">{{result["count"]}}本</div>
                    </div>
                    <div class="card-body">
                        <div class="card-title">{{result["title"]}}</div>
                    </div>
                </div>
            </a>
            {% endif %}

            {% endfor %}
        </div>

        <!-- ページ送り -->
        <div class="pager">
            <a href="{{next}}">次のページ →</a>
        </div>

    </div>
</div>

<script>
    $('#searchbox').autocomplete({
        source: function (request, response) {
            fetch("/suggest?keyword=" + request.term)
                .then(res => res.json())
                .then(data => response(data));
        },
        delay: 300
    });
</script>

</body>
</html>
